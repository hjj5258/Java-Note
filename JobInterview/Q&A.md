### 问题

 - 如何保证幂等性

    - 一种是下游系统提供查询接口，上游系统timeout了之后进行查询，查询到了就说明已经做了，失败的话就走失败流程（插入前查询）

    - 另一种是通过幂等性的方式，把查询操作交由下游系统去做，上游系统可以一直重试，下游系统保证多次请求结果还是一样的。

      例如交易系统中会有全局ID，Snowflake算法生成

   - PRG模式

     - 后端成功后向前端返回 302 跳转，把用户的前端页跳转到 GET 请求，把刚刚 POST 的数据给展示出来。如果是 Web 上的最好还把之前的表单设置成过期，这样用户不能通过浏览器后退按钮来重新提交。

   - token表单机制

   - 状态机 ，待支付->支付中->支付完成  单向改变（不可逆）

   - 乐观锁 version

   - 数据库唯一索引

